"use strict";
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];
    result["default"] = mod;
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const responses = __importStar(require("../responses"));
const getLambdaConfig_1 = __importDefault(require("./getLambdaConfig"));
const getRequestInfosFromEvent_1 = __importDefault(require("./getRequestInfosFromEvent"));
function createRouterHandler(processHandler) {
    return async function (event, context) {
        const config = await getLambdaConfig_1.default();
        const requestInfos = getRequestInfosFromEvent_1.default(event);
        const ctx = { ...requestInfos, config, responses };
        if ((config['statics'] || {})[ctx.path]) {
            return responses.staticFile({ root: config.root, ...config['statics'][ctx.path] });
        }
        try {
            return await processHandler(ctx, event, context);
        }
        catch (e) {
            return responses.httpError({ statusCode: 500 });
        }
    };
}
exports.createRouterHandler = createRouterHandler;
exports.default = createRouterHandler;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3JlYXRlUm91dGVySGFuZGxlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlscy9jcmVhdGVSb3V0ZXJIYW5kbGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQUFBLHdEQUEwQztBQUMxQyx3RUFBZ0Q7QUFDaEQsMEZBQWtFO0FBR2xFLFNBQWdCLG1CQUFtQixDQUFDLGNBQTBEO0lBQzFGLE9BQU8sS0FBSyxXQUFXLEtBQUssRUFBRSxPQUFPO1FBQ2pDLE1BQU0sTUFBTSxHQUFHLE1BQU0seUJBQWUsRUFBRSxDQUFDO1FBQ3ZDLE1BQU0sWUFBWSxHQUFHLGtDQUF3QixDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3JELE1BQU0sR0FBRyxHQUFHLEVBQUMsR0FBRyxZQUFZLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBQyxDQUFDO1FBQ2pELElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFO1lBQ3JDLE9BQU8sU0FBUyxDQUFDLFVBQVUsQ0FBQyxFQUFDLElBQUksRUFBRSxNQUFNLENBQUMsSUFBSSxFQUFFLEdBQUcsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBQyxDQUFDLENBQUM7U0FDcEY7UUFFRCxJQUFJO1lBRUEsT0FBTyxNQUFNLGNBQWMsQ0FBQyxHQUFHLEVBQUUsS0FBSyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1NBQ3BEO1FBQUMsT0FBTyxDQUFDLEVBQUU7WUFDUixPQUFPLFNBQVMsQ0FBQyxTQUFTLENBQUMsRUFBQyxVQUFVLEVBQUUsR0FBRyxFQUFDLENBQUMsQ0FBQztTQUNqRDtJQUNMLENBQUMsQ0FBQTtBQUNMLENBQUM7QUFoQkQsa0RBZ0JDO0FBRUQsa0JBQWUsbUJBQW1CLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyByZXNwb25zZXMgZnJvbSAnLi4vcmVzcG9uc2VzJztcbmltcG9ydCBnZXRMYW1iZGFDb25maWcgZnJvbSBcIi4vZ2V0TGFtYmRhQ29uZmlnXCI7XG5pbXBvcnQgZ2V0UmVxdWVzdEluZm9zRnJvbUV2ZW50IGZyb20gXCIuL2dldFJlcXVlc3RJbmZvc0Zyb21FdmVudFwiO1xuaW1wb3J0IHtjdHh9IGZyb20gXCIuLi90eXBlc1wiO1xuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlUm91dGVySGFuZGxlcihwcm9jZXNzSGFuZGxlcjogKGN0eDogY3R4LCBldmVudCwgY29udGV4dCkgPT4gUHJvbWlzZTxhbnk+KSB7XG4gICAgcmV0dXJuIGFzeW5jIGZ1bmN0aW9uIChldmVudCwgY29udGV4dCkge1xuICAgICAgICBjb25zdCBjb25maWcgPSBhd2FpdCBnZXRMYW1iZGFDb25maWcoKTtcbiAgICAgICAgY29uc3QgcmVxdWVzdEluZm9zID0gZ2V0UmVxdWVzdEluZm9zRnJvbUV2ZW50KGV2ZW50KTtcbiAgICAgICAgY29uc3QgY3R4ID0gey4uLnJlcXVlc3RJbmZvcywgY29uZmlnLCByZXNwb25zZXN9O1xuICAgICAgICBpZiAoKGNvbmZpZ1snc3RhdGljcyddIHx8IHt9KVtjdHgucGF0aF0pIHtcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZXMuc3RhdGljRmlsZSh7cm9vdDogY29uZmlnLnJvb3QsIC4uLmNvbmZpZ1snc3RhdGljcyddW2N0eC5wYXRoXX0pO1xuICAgICAgICB9XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIHdlIGRvIHRoZSBgYXdhaXRgIGhlcmUgYmVjYXVzZSB3ZSBuZWVkIHRvIGNhdGNoIGVycm9yIGhlcmVcbiAgICAgICAgICAgIHJldHVybiBhd2FpdCBwcm9jZXNzSGFuZGxlcihjdHgsIGV2ZW50LCBjb250ZXh0KTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlcy5odHRwRXJyb3Ioe3N0YXR1c0NvZGU6IDUwMH0pO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBjcmVhdGVSb3V0ZXJIYW5kbGVyIl19