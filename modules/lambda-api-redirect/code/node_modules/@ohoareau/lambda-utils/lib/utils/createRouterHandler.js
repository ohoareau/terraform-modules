"use strict";
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];
    result["default"] = mod;
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const responses = __importStar(require("../responses"));
const getLambdaConfig_1 = __importDefault(require("./getLambdaConfig"));
const getRequestInfosFromEvent_1 = __importDefault(require("./getRequestInfosFromEvent"));
function createRouterHandler(processHandler) {
    return async function (event, context) {
        const config = await getLambdaConfig_1.default();
        const requestInfos = getRequestInfosFromEvent_1.default(event);
        const ctx = { ...requestInfos, config, responses };
        if ((config['statics'] || {})[ctx.path]) {
            return responses.staticFile({ root: config.root, ...config['statics'][ctx.path] });
        }
        try {
            return await processHandler(ctx, event, context);
        }
        catch (e) {
            console.error(e);
            return responses.httpError({ statusCode: 500 });
        }
    };
}
exports.createRouterHandler = createRouterHandler;
exports.default = createRouterHandler;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3JlYXRlUm91dGVySGFuZGxlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlscy9jcmVhdGVSb3V0ZXJIYW5kbGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQUFBLHdEQUEwQztBQUMxQyx3RUFBZ0Q7QUFDaEQsMEZBQWtFO0FBR2xFLFNBQWdCLG1CQUFtQixDQUFDLGNBQTBEO0lBQzFGLE9BQU8sS0FBSyxXQUFXLEtBQUssRUFBRSxPQUFPO1FBQ2pDLE1BQU0sTUFBTSxHQUFHLE1BQU0seUJBQWUsRUFBRSxDQUFDO1FBQ3ZDLE1BQU0sWUFBWSxHQUFHLGtDQUF3QixDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3JELE1BQU0sR0FBRyxHQUFHLEVBQUMsR0FBRyxZQUFZLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBQyxDQUFDO1FBQ2pELElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFO1lBQ3JDLE9BQU8sU0FBUyxDQUFDLFVBQVUsQ0FBQyxFQUFDLElBQUksRUFBRSxNQUFNLENBQUMsSUFBSSxFQUFFLEdBQUcsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBQyxDQUFDLENBQUM7U0FDcEY7UUFFRCxJQUFJO1lBRUEsT0FBTyxNQUFNLGNBQWMsQ0FBQyxHQUFHLEVBQUUsS0FBSyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1NBQ3BEO1FBQUMsT0FBTyxDQUFDLEVBQUU7WUFDUixPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2pCLE9BQU8sU0FBUyxDQUFDLFNBQVMsQ0FBQyxFQUFDLFVBQVUsRUFBRSxHQUFHLEVBQUMsQ0FBQyxDQUFDO1NBQ2pEO0lBQ0wsQ0FBQyxDQUFBO0FBQ0wsQ0FBQztBQWpCRCxrREFpQkM7QUFFRCxrQkFBZSxtQkFBbUIsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIHJlc3BvbnNlcyBmcm9tICcuLi9yZXNwb25zZXMnO1xuaW1wb3J0IGdldExhbWJkYUNvbmZpZyBmcm9tIFwiLi9nZXRMYW1iZGFDb25maWdcIjtcbmltcG9ydCBnZXRSZXF1ZXN0SW5mb3NGcm9tRXZlbnQgZnJvbSBcIi4vZ2V0UmVxdWVzdEluZm9zRnJvbUV2ZW50XCI7XG5pbXBvcnQge2N0eH0gZnJvbSBcIi4uL3R5cGVzXCI7XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVSb3V0ZXJIYW5kbGVyKHByb2Nlc3NIYW5kbGVyOiAoY3R4OiBjdHgsIGV2ZW50LCBjb250ZXh0KSA9PiBQcm9taXNlPGFueT4pIHtcbiAgICByZXR1cm4gYXN5bmMgZnVuY3Rpb24gKGV2ZW50LCBjb250ZXh0KSB7XG4gICAgICAgIGNvbnN0IGNvbmZpZyA9IGF3YWl0IGdldExhbWJkYUNvbmZpZygpO1xuICAgICAgICBjb25zdCByZXF1ZXN0SW5mb3MgPSBnZXRSZXF1ZXN0SW5mb3NGcm9tRXZlbnQoZXZlbnQpO1xuICAgICAgICBjb25zdCBjdHggPSB7Li4ucmVxdWVzdEluZm9zLCBjb25maWcsIHJlc3BvbnNlc307XG4gICAgICAgIGlmICgoY29uZmlnWydzdGF0aWNzJ10gfHwge30pW2N0eC5wYXRoXSkge1xuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlcy5zdGF0aWNGaWxlKHtyb290OiBjb25maWcucm9vdCwgLi4uY29uZmlnWydzdGF0aWNzJ11bY3R4LnBhdGhdfSk7XG4gICAgICAgIH1cblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgLy8gd2UgZG8gdGhlIGBhd2FpdGAgaGVyZSBiZWNhdXNlIHdlIG5lZWQgdG8gY2F0Y2ggZXJyb3IgaGVyZVxuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHByb2Nlc3NIYW5kbGVyKGN0eCwgZXZlbnQsIGNvbnRleHQpO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlcy5odHRwRXJyb3Ioe3N0YXR1c0NvZGU6IDUwMH0pO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBjcmVhdGVSb3V0ZXJIYW5kbGVyIl19