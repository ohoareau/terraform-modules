"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const aws_1 = require("@ohoareau/aws");
async function dynamodb({ table, index = undefined, key = 'id', path }) {
    const tablePrefix = process.env[`DYNAMODB_${table.toUpperCase()}_TABLE_PREFIX`] || process.env.DYNAMODB_TABLE_PREFIX || undefined;
    table = tablePrefix ? `${tablePrefix}${table}` : table;
    try {
        const page = await aws_1.dynamodb.queryIndex(table, { [key]: path }, index);
        if (!page || !page.items || !page.items.length)
            return undefined;
        const data = page.items[0];
        if (!data || !data.location)
            return undefined;
        return { ...data };
    }
    catch (e) {
        console.error(e);
        return undefined;
    }
}
exports.dynamodb = dynamodb;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHluYW1vZGIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvcnVsZS10eXBlcy9keW5hbW9kYi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLHVDQUFzRDtBQUUvQyxLQUFLLFVBQVUsUUFBUSxDQUFDLEVBQUMsS0FBSyxFQUFFLEtBQUssR0FBRyxTQUFTLEVBQUUsR0FBRyxHQUFHLElBQUksRUFBRSxJQUFJLEVBQThEO0lBQ3BJLE1BQU0sV0FBVyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsWUFBWSxLQUFLLENBQUMsV0FBVyxFQUFFLGVBQWUsQ0FBQyxJQUFJLE9BQU8sQ0FBQyxHQUFHLENBQUMscUJBQXFCLElBQUksU0FBUyxDQUFDO0lBQ2xJLEtBQUssR0FBRyxXQUFXLENBQUMsQ0FBQyxDQUFDLEdBQUcsV0FBVyxHQUFHLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUM7SUFDdkQsSUFBSTtRQUNBLE1BQU0sSUFBSSxHQUFHLE1BQU0sY0FBVyxDQUFDLFVBQVUsQ0FBQyxLQUFLLEVBQUUsRUFBQyxDQUFDLEdBQUcsQ0FBQyxFQUFFLElBQUksRUFBQyxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQ3ZFLElBQUksQ0FBQyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNO1lBQUUsT0FBTyxTQUFTLENBQUM7UUFDakUsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMzQixJQUFJLENBQUMsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVE7WUFBRSxPQUFPLFNBQVMsQ0FBQztRQUM5QyxPQUFPLEVBQUMsR0FBRyxJQUFJLEVBQUMsQ0FBQztLQUNwQjtJQUFDLE9BQU8sQ0FBQyxFQUFFO1FBQ1IsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNqQixPQUFPLFNBQVMsQ0FBQztLQUNwQjtBQUNMLENBQUM7QUFiRCw0QkFhQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7ZHluYW1vZGIgYXMgYXdzZHluYW1vZGJ9IGZyb20gJ0BvaG9hcmVhdS9hd3MnO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZHluYW1vZGIoe3RhYmxlLCBpbmRleCA9IHVuZGVmaW5lZCwga2V5ID0gJ2lkJywgcGF0aH06IHt0YWJsZTogc3RyaW5nLCBpbmRleD86IHN0cmluZywga2V5Pzogc3RyaW5nLCBwYXRoOiBzdHJpbmd9KSB7XG4gICAgY29uc3QgdGFibGVQcmVmaXggPSBwcm9jZXNzLmVudltgRFlOQU1PREJfJHt0YWJsZS50b1VwcGVyQ2FzZSgpfV9UQUJMRV9QUkVGSVhgXSB8fCBwcm9jZXNzLmVudi5EWU5BTU9EQl9UQUJMRV9QUkVGSVggfHwgdW5kZWZpbmVkO1xuICAgIHRhYmxlID0gdGFibGVQcmVmaXggPyBgJHt0YWJsZVByZWZpeH0ke3RhYmxlfWAgOiB0YWJsZTtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBwYWdlID0gYXdhaXQgYXdzZHluYW1vZGIucXVlcnlJbmRleCh0YWJsZSwge1trZXldOiBwYXRofSwgaW5kZXgpO1xuICAgICAgICBpZiAoIXBhZ2UgfHwgIXBhZ2UuaXRlbXMgfHwgIXBhZ2UuaXRlbXMubGVuZ3RoKSByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICBjb25zdCBkYXRhID0gcGFnZS5pdGVtc1swXTtcbiAgICAgICAgaWYgKCFkYXRhIHx8ICFkYXRhLmxvY2F0aW9uKSByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICByZXR1cm4gey4uLmRhdGF9O1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihlKTtcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG59Il19