"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const lambda_utils_1 = require("@ohoareau/lambda-utils");
const mapping = {
    icon: '16x16',
    'fb-profile': '180x180',
    'fb-cover': '828x315',
    'fb-shared-image': '1200x630',
    'fb-shared-link': '1200x627',
    'fb-highlighted-image': '1200x717',
    'in-bg-image': '1000x425',
    'in-standard-logo': '100x60',
    'in-profile-image': '400x400',
    'in-career-cover-photo': '974x300',
    'in-banner-image': '646x200',
    'in-square-logo': '50x50',
    'yt-channel-cover-photo': '2560x1440',
    'yt-video-upload': '1280x760',
    'ig-profile-image': '110x110',
    'ig-photo-thumbnail': '161x161',
    'ig-photo-size': '1080x1080',
    'tw-header-photo': '1500x500',
    'tw-profile-photo': '400x400',
    'tw-in-stream-photo': '440x220',
    'pi-profile-image': '165x165',
    'pi-board-display': '222x150',
    'pi-board-display-small': '55x55',
    'pi-pin-size': '236x',
};
async function size(order, request) {
    var _a, _b, _c, _d, _e, _f, _g, _h, _j;
    let size = (_a = request.qsParams) === null || _a === void 0 ? void 0 : _a.size;
    if (!size)
        return;
    if (Array.isArray(size))
        size = size[0];
    if (!size)
        return;
    size = mapping[size] || size;
    if (!size)
        return;
    const [width = undefined, height = undefined] = size.split('x');
    const fit = lambda_utils_1.filterValues((_b = request.qsParams) === null || _b === void 0 ? void 0 : _b.size_fit, ['cover', 'contain', 'fill', 'inside', 'outside']);
    const position = lambda_utils_1.filterValues((_c = request.qsParams) === null || _c === void 0 ? void 0 : _c.size_position, ['top', 'right-top', 'right', 'right-bottom', 'bottom', 'left-bottom', 'left', 'left-top'], 'space');
    const gravity = lambda_utils_1.filterValues((_d = request.qsParams) === null || _d === void 0 ? void 0 : _d.size_gravity, ['north', 'northeast', 'east', 'southeast', 'south', 'southwest', 'west', 'northwest', 'center', 'centre']);
    const strategy = lambda_utils_1.filterValues((_e = request.qsParams) === null || _e === void 0 ? void 0 : _e.size_strategy, ['entropy', 'attention']);
    const background = (_f = request.qsParams) === null || _f === void 0 ? void 0 : _f.size_background;
    const kernel = lambda_utils_1.filterValues((_g = request.qsParams) === null || _g === void 0 ? void 0 : _g.size_kernel, ['nearest', 'cubic', 'mitchell', 'lanczos2', 'lanczos3']);
    const withoutEnlargement = lambda_utils_1.filterValues((_h = request.qsParams) === null || _h === void 0 ? void 0 : _h.size_enlargement, ['0', '1', 'false', 'true', 'none', 'no', 'yes'], 'boolean');
    const fastShrinkOnLoad = lambda_utils_1.filterValues((_j = request.qsParams) === null || _j === void 0 ? void 0 : _j.size_fastshrink, ['0', '1', 'false', 'true', 'none', 'no', 'yes'], 'boolean');
    order.operations.push({
        type: 'resize',
        width: !!width ? width : undefined,
        height: !!height ? height : undefined,
        ...(fit ? { fit } : {}),
        ...(position ? { position } : {}),
        ...(gravity ? { gravity } : {}),
        ...(strategy ? { strategy } : {}),
        ...(background ? { background } : {}),
        ...(kernel ? { kernel } : {}),
        ...(withoutEnlargement ? { withoutEnlargement } : {}),
        ...(fastShrinkOnLoad ? { fastShrinkOnLoad } : {}),
    });
}
exports.size = size;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2l6ZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9tb2RpZmllcnMvc2l6ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUNBLHlEQUFrRTtBQUVsRSxNQUFNLE9BQU8sR0FBRztJQUNaLElBQUksRUFBRSxPQUFPO0lBQ2IsWUFBWSxFQUFFLFNBQVM7SUFDdkIsVUFBVSxFQUFFLFNBQVM7SUFDckIsaUJBQWlCLEVBQUUsVUFBVTtJQUM3QixnQkFBZ0IsRUFBRSxVQUFVO0lBQzVCLHNCQUFzQixFQUFFLFVBQVU7SUFDbEMsYUFBYSxFQUFFLFVBQVU7SUFDekIsa0JBQWtCLEVBQUUsUUFBUTtJQUM1QixrQkFBa0IsRUFBRSxTQUFTO0lBQzdCLHVCQUF1QixFQUFFLFNBQVM7SUFDbEMsaUJBQWlCLEVBQUUsU0FBUztJQUM1QixnQkFBZ0IsRUFBRSxPQUFPO0lBQ3pCLHdCQUF3QixFQUFFLFdBQVc7SUFDckMsaUJBQWlCLEVBQUUsVUFBVTtJQUM3QixrQkFBa0IsRUFBRSxTQUFTO0lBQzdCLG9CQUFvQixFQUFFLFNBQVM7SUFDL0IsZUFBZSxFQUFFLFdBQVc7SUFDNUIsaUJBQWlCLEVBQUUsVUFBVTtJQUM3QixrQkFBa0IsRUFBRSxTQUFTO0lBQzdCLG9CQUFvQixFQUFFLFNBQVM7SUFDL0Isa0JBQWtCLEVBQUUsU0FBUztJQUM3QixrQkFBa0IsRUFBRSxTQUFTO0lBQzdCLHdCQUF3QixFQUFFLE9BQU87SUFDakMsYUFBYSxFQUFFLE1BQU07Q0FDeEIsQ0FBQztBQUVLLEtBQUssVUFBVSxJQUFJLENBQUMsS0FBWSxFQUFFLE9BQXFCOztJQUMxRCxJQUFJLElBQUksU0FBRyxPQUFPLENBQUMsUUFBUSwwQ0FBRSxJQUFJLENBQUM7SUFDbEMsSUFBSSxDQUFDLElBQUk7UUFBRSxPQUFPO0lBQ2xCLElBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUM7UUFBRSxJQUFJLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3hDLElBQUksQ0FBQyxJQUFJO1FBQUUsT0FBTztJQUNsQixJQUFJLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLElBQUksQ0FBQztJQUM3QixJQUFJLENBQUMsSUFBSTtRQUFFLE9BQU87SUFDbEIsTUFBTSxDQUFDLEtBQUssR0FBRyxTQUFTLEVBQUUsTUFBTSxHQUFHLFNBQVMsQ0FBQyxHQUFJLElBQWUsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDNUUsTUFBTSxHQUFHLEdBQUcsMkJBQVksQ0FBQyxNQUFBLE9BQU8sQ0FBQyxRQUFRLDBDQUFFLFFBQWUsRUFBRSxDQUFDLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxTQUFTLENBQUMsQ0FBQyxDQUFDO0lBQy9HLE1BQU0sUUFBUSxHQUFHLDJCQUFZLENBQUMsTUFBQSxPQUFPLENBQUMsUUFBUSwwQ0FBRSxhQUFvQixFQUFFLENBQUMsS0FBSyxFQUFFLFdBQVcsRUFBRSxPQUFPLEVBQUUsY0FBYyxFQUFFLFFBQVEsRUFBRSxhQUFhLEVBQUUsTUFBTSxFQUFFLFVBQVUsQ0FBQyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQzNLLE1BQU0sT0FBTyxHQUFHLDJCQUFZLENBQUMsTUFBQSxPQUFPLENBQUMsUUFBUSwwQ0FBRSxZQUFtQixFQUFFLENBQUMsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLEVBQUUsV0FBVyxFQUFFLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxFQUFFLFdBQVcsRUFBRSxRQUFRLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBQztJQUNoTCxNQUFNLFFBQVEsR0FBRywyQkFBWSxDQUFDLE1BQUEsT0FBTyxDQUFDLFFBQVEsMENBQUUsYUFBb0IsRUFBRSxDQUFDLFNBQVMsRUFBRSxXQUFXLENBQUMsQ0FBQyxDQUFDO0lBQ2hHLE1BQU0sVUFBVSxHQUFHLE1BQUEsT0FBTyxDQUFDLFFBQVEsMENBQUUsZUFBc0IsQ0FBQztJQUM1RCxNQUFNLE1BQU0sR0FBRywyQkFBWSxDQUFDLE1BQUEsT0FBTyxDQUFDLFFBQVEsMENBQUUsV0FBa0IsRUFBRSxDQUFDLFNBQVMsRUFBRSxPQUFPLEVBQUUsVUFBVSxFQUFFLFVBQVUsRUFBRSxVQUFVLENBQUMsQ0FBQyxDQUFDO0lBQzVILE1BQU0sa0JBQWtCLEdBQUcsMkJBQVksQ0FBQyxNQUFBLE9BQU8sQ0FBQyxRQUFRLDBDQUFFLGdCQUF1QixFQUFFLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsS0FBSyxDQUFDLEVBQUUsU0FBUyxDQUFDLENBQUM7SUFDaEosTUFBTSxnQkFBZ0IsR0FBRywyQkFBWSxDQUFDLE1BQUEsT0FBTyxDQUFDLFFBQVEsMENBQUUsZUFBc0IsRUFBRSxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLEtBQUssQ0FBQyxFQUFFLFNBQVMsQ0FBQyxDQUFDO0lBQzdJLEtBQUssQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDO1FBQ2xCLElBQUksRUFBRSxRQUFRO1FBQ2QsS0FBSyxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsU0FBUztRQUNsQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxTQUFTO1FBQ3JDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUMsR0FBRyxFQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztRQUNyQixHQUFHLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxFQUFDLFFBQVEsRUFBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7UUFDL0IsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBQyxPQUFPLEVBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO1FBQzdCLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLEVBQUMsUUFBUSxFQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztRQUMvQixHQUFHLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxFQUFDLFVBQVUsRUFBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7UUFDbkMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBQyxNQUFNLEVBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO1FBQzNCLEdBQUcsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLENBQUMsRUFBQyxrQkFBa0IsRUFBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7UUFDbkQsR0FBRyxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxFQUFDLGdCQUFnQixFQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztLQUNsRCxDQUFDLENBQUM7QUFDUCxDQUFDO0FBN0JELG9CQTZCQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7b3JkZXJ9IGZyb20gJy4uL3R5cGVzJztcbmltcG9ydCB7ZmlsdGVyVmFsdWVzLCBodHRwX3JlcXVlc3R9IGZyb20gXCJAb2hvYXJlYXUvbGFtYmRhLXV0aWxzXCI7XG5cbmNvbnN0IG1hcHBpbmcgPSB7XG4gICAgaWNvbjogJzE2eDE2JyxcbiAgICAnZmItcHJvZmlsZSc6ICcxODB4MTgwJyxcbiAgICAnZmItY292ZXInOiAnODI4eDMxNScsXG4gICAgJ2ZiLXNoYXJlZC1pbWFnZSc6ICcxMjAweDYzMCcsXG4gICAgJ2ZiLXNoYXJlZC1saW5rJzogJzEyMDB4NjI3JyxcbiAgICAnZmItaGlnaGxpZ2h0ZWQtaW1hZ2UnOiAnMTIwMHg3MTcnLFxuICAgICdpbi1iZy1pbWFnZSc6ICcxMDAweDQyNScsXG4gICAgJ2luLXN0YW5kYXJkLWxvZ28nOiAnMTAweDYwJyxcbiAgICAnaW4tcHJvZmlsZS1pbWFnZSc6ICc0MDB4NDAwJyxcbiAgICAnaW4tY2FyZWVyLWNvdmVyLXBob3RvJzogJzk3NHgzMDAnLFxuICAgICdpbi1iYW5uZXItaW1hZ2UnOiAnNjQ2eDIwMCcsXG4gICAgJ2luLXNxdWFyZS1sb2dvJzogJzUweDUwJyxcbiAgICAneXQtY2hhbm5lbC1jb3Zlci1waG90byc6ICcyNTYweDE0NDAnLFxuICAgICd5dC12aWRlby11cGxvYWQnOiAnMTI4MHg3NjAnLFxuICAgICdpZy1wcm9maWxlLWltYWdlJzogJzExMHgxMTAnLFxuICAgICdpZy1waG90by10aHVtYm5haWwnOiAnMTYxeDE2MScsXG4gICAgJ2lnLXBob3RvLXNpemUnOiAnMTA4MHgxMDgwJyxcbiAgICAndHctaGVhZGVyLXBob3RvJzogJzE1MDB4NTAwJyxcbiAgICAndHctcHJvZmlsZS1waG90byc6ICc0MDB4NDAwJyxcbiAgICAndHctaW4tc3RyZWFtLXBob3RvJzogJzQ0MHgyMjAnLFxuICAgICdwaS1wcm9maWxlLWltYWdlJzogJzE2NXgxNjUnLFxuICAgICdwaS1ib2FyZC1kaXNwbGF5JzogJzIyMngxNTAnLFxuICAgICdwaS1ib2FyZC1kaXNwbGF5LXNtYWxsJzogJzU1eDU1JyxcbiAgICAncGktcGluLXNpemUnOiAnMjM2eCcsXG59O1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2l6ZShvcmRlcjogb3JkZXIsIHJlcXVlc3Q6IGh0dHBfcmVxdWVzdCkge1xuICAgIGxldCBzaXplID0gcmVxdWVzdC5xc1BhcmFtcz8uc2l6ZTtcbiAgICBpZiAoIXNpemUpIHJldHVybjtcbiAgICBpZiAoQXJyYXkuaXNBcnJheShzaXplKSkgc2l6ZSA9IHNpemVbMF07XG4gICAgaWYgKCFzaXplKSByZXR1cm47XG4gICAgc2l6ZSA9IG1hcHBpbmdbc2l6ZV0gfHwgc2l6ZTtcbiAgICBpZiAoIXNpemUpIHJldHVybjtcbiAgICBjb25zdCBbd2lkdGggPSB1bmRlZmluZWQsIGhlaWdodCA9IHVuZGVmaW5lZF0gPSAoc2l6ZSBhcyBzdHJpbmcpLnNwbGl0KCd4Jyk7XG4gICAgY29uc3QgZml0ID0gZmlsdGVyVmFsdWVzKHJlcXVlc3QucXNQYXJhbXM/LnNpemVfZml0IGFzIGFueSwgWydjb3ZlcicsICdjb250YWluJywgJ2ZpbGwnLCAnaW5zaWRlJywgJ291dHNpZGUnXSk7XG4gICAgY29uc3QgcG9zaXRpb24gPSBmaWx0ZXJWYWx1ZXMocmVxdWVzdC5xc1BhcmFtcz8uc2l6ZV9wb3NpdGlvbiBhcyBhbnksIFsndG9wJywgJ3JpZ2h0LXRvcCcsICdyaWdodCcsICdyaWdodC1ib3R0b20nLCAnYm90dG9tJywgJ2xlZnQtYm90dG9tJywgJ2xlZnQnLCAnbGVmdC10b3AnXSwgJ3NwYWNlJyk7XG4gICAgY29uc3QgZ3Jhdml0eSA9IGZpbHRlclZhbHVlcyhyZXF1ZXN0LnFzUGFyYW1zPy5zaXplX2dyYXZpdHkgYXMgYW55LCBbJ25vcnRoJywgJ25vcnRoZWFzdCcsICdlYXN0JywgJ3NvdXRoZWFzdCcsICdzb3V0aCcsICdzb3V0aHdlc3QnLCAnd2VzdCcsICdub3J0aHdlc3QnLCAnY2VudGVyJywgJ2NlbnRyZSddKTtcbiAgICBjb25zdCBzdHJhdGVneSA9IGZpbHRlclZhbHVlcyhyZXF1ZXN0LnFzUGFyYW1zPy5zaXplX3N0cmF0ZWd5IGFzIGFueSwgWydlbnRyb3B5JywgJ2F0dGVudGlvbiddKTtcbiAgICBjb25zdCBiYWNrZ3JvdW5kID0gcmVxdWVzdC5xc1BhcmFtcz8uc2l6ZV9iYWNrZ3JvdW5kIGFzIGFueTtcbiAgICBjb25zdCBrZXJuZWwgPSBmaWx0ZXJWYWx1ZXMocmVxdWVzdC5xc1BhcmFtcz8uc2l6ZV9rZXJuZWwgYXMgYW55LCBbJ25lYXJlc3QnLCAnY3ViaWMnLCAnbWl0Y2hlbGwnLCAnbGFuY3pvczInLCAnbGFuY3pvczMnXSk7XG4gICAgY29uc3Qgd2l0aG91dEVubGFyZ2VtZW50ID0gZmlsdGVyVmFsdWVzKHJlcXVlc3QucXNQYXJhbXM/LnNpemVfZW5sYXJnZW1lbnQgYXMgYW55LCBbJzAnLCAnMScsICdmYWxzZScsICd0cnVlJywgJ25vbmUnLCAnbm8nLCAneWVzJ10sICdib29sZWFuJyk7XG4gICAgY29uc3QgZmFzdFNocmlua09uTG9hZCA9IGZpbHRlclZhbHVlcyhyZXF1ZXN0LnFzUGFyYW1zPy5zaXplX2Zhc3RzaHJpbmsgYXMgYW55LCBbJzAnLCAnMScsICdmYWxzZScsICd0cnVlJywgJ25vbmUnLCAnbm8nLCAneWVzJ10sICdib29sZWFuJyk7XG4gICAgb3JkZXIub3BlcmF0aW9ucy5wdXNoKHtcbiAgICAgICAgdHlwZTogJ3Jlc2l6ZScsXG4gICAgICAgIHdpZHRoOiAhIXdpZHRoID8gd2lkdGggOiB1bmRlZmluZWQsXG4gICAgICAgIGhlaWdodDogISFoZWlnaHQgPyBoZWlnaHQgOiB1bmRlZmluZWQsXG4gICAgICAgIC4uLihmaXQgPyB7Zml0fSA6IHt9KSxcbiAgICAgICAgLi4uKHBvc2l0aW9uID8ge3Bvc2l0aW9ufSA6IHt9KSxcbiAgICAgICAgLi4uKGdyYXZpdHkgPyB7Z3Jhdml0eX0gOiB7fSksXG4gICAgICAgIC4uLihzdHJhdGVneSA/IHtzdHJhdGVneX0gOiB7fSksXG4gICAgICAgIC4uLihiYWNrZ3JvdW5kID8ge2JhY2tncm91bmR9IDoge30pLFxuICAgICAgICAuLi4oa2VybmVsID8ge2tlcm5lbH0gOiB7fSksXG4gICAgICAgIC4uLih3aXRob3V0RW5sYXJnZW1lbnQgPyB7d2l0aG91dEVubGFyZ2VtZW50fSA6IHt9KSxcbiAgICAgICAgLi4uKGZhc3RTaHJpbmtPbkxvYWQgPyB7ZmFzdFNocmlua09uTG9hZH0gOiB7fSksXG4gICAgfSk7XG59Il19