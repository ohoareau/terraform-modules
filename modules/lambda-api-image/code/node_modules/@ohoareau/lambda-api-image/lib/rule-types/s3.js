"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const detectContentTypeFromFileName_1 = __importDefault(require("../utils/detectContentTypeFromFileName"));
async function s3(request, rule, config) {
    const { bucket, key } = (rule === null || rule === void 0 ? void 0 : rule.params) || {};
    const bucketName = (config.buckets || {})[bucket];
    if (!bucketName || !key)
        throw new Error(`Unspecified bucket and/or key for s3 object`);
    const options = {};
    const contentType = detectContentTypeFromFileName_1.default(key);
    contentType && (options.contentType = contentType);
    return {
        input: `s3://${bucketName}/${key}`,
        options,
    };
}
exports.s3 = s3;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiczMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvcnVsZS10eXBlcy9zMy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUNBLDJHQUFtRjtBQUU1RSxLQUFLLFVBQVUsRUFBRSxDQUFDLE9BQWdCLEVBQUUsSUFBVSxFQUFFLE1BQVc7SUFDOUQsTUFBTSxFQUFDLE1BQU0sRUFBRSxHQUFHLEVBQUMsR0FBRyxDQUFBLElBQUksYUFBSixJQUFJLHVCQUFKLElBQUksQ0FBRSxNQUFNLEtBQUksRUFBRSxDQUFDO0lBQ3pDLE1BQU0sVUFBVSxHQUFHLENBQUMsTUFBTSxDQUFDLE9BQU8sSUFBSSxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNsRCxJQUFJLENBQUMsVUFBVSxJQUFJLENBQUMsR0FBRztRQUFFLE1BQU0sSUFBSSxLQUFLLENBQUMsNkNBQTZDLENBQUMsQ0FBQztJQUN4RixNQUFNLE9BQU8sR0FBUSxFQUFFLENBQUM7SUFDeEIsTUFBTSxXQUFXLEdBQUcsdUNBQTZCLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDdkQsV0FBVyxJQUFJLENBQUMsT0FBTyxDQUFDLFdBQVcsR0FBRyxXQUFXLENBQUMsQ0FBQztJQUNuRCxPQUFPO1FBQ0gsS0FBSyxFQUFFLFFBQVEsVUFBVSxJQUFJLEdBQUcsRUFBRTtRQUNsQyxPQUFPO0tBQ1YsQ0FBQztBQUNOLENBQUM7QUFYRCxnQkFXQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7cmVxdWVzdCwgcnVsZX0gZnJvbSBcIi4uL3R5cGVzXCI7XG5pbXBvcnQgZGV0ZWN0Q29udGVudFR5cGVGcm9tRmlsZU5hbWUgZnJvbSBcIi4uL3V0aWxzL2RldGVjdENvbnRlbnRUeXBlRnJvbUZpbGVOYW1lXCI7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzMyhyZXF1ZXN0OiByZXF1ZXN0LCBydWxlOiBydWxlLCBjb25maWc6IGFueSkge1xuICAgIGNvbnN0IHtidWNrZXQsIGtleX0gPSBydWxlPy5wYXJhbXMgfHwge307XG4gICAgY29uc3QgYnVja2V0TmFtZSA9IChjb25maWcuYnVja2V0cyB8fCB7fSlbYnVja2V0XTtcbiAgICBpZiAoIWJ1Y2tldE5hbWUgfHwgIWtleSkgdGhyb3cgbmV3IEVycm9yKGBVbnNwZWNpZmllZCBidWNrZXQgYW5kL29yIGtleSBmb3IgczMgb2JqZWN0YCk7XG4gICAgY29uc3Qgb3B0aW9uczogYW55ID0ge307XG4gICAgY29uc3QgY29udGVudFR5cGUgPSBkZXRlY3RDb250ZW50VHlwZUZyb21GaWxlTmFtZShrZXkpO1xuICAgIGNvbnRlbnRUeXBlICYmIChvcHRpb25zLmNvbnRlbnRUeXBlID0gY29udGVudFR5cGUpO1xuICAgIHJldHVybiB7XG4gICAgICAgIGlucHV0OiBgczM6Ly8ke2J1Y2tldE5hbWV9LyR7a2V5fWAsXG4gICAgICAgIG9wdGlvbnMsXG4gICAgfTtcbn0iXX0=