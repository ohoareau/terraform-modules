"use strict";
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];
    result["default"] = mod;
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
const lambda_utils_1 = require("@ohoareau/lambda-utils");
const availableSources = __importStar(require("../sources"));
const react_document_renderer_1 = require("@ohoareau/react-document-renderer");
async function generate(ctx) {
    const sources = { ...availableSources, ...(ctx.config.sources || {}) };
    const sourceName = ctx.query.source || 'default';
    const source = sources[sourceName];
    if (!source)
        return ctx.helpers.httpNotFound();
    const sourced = (await source(ctx)) || {};
    if (!sourced || !sourced.definition)
        return ctx.helpers.httpNotFound();
    try {
        return ctx.helpers.buffer({ contentType: 'application/pdf', ...sourced, buffer: await react_document_renderer_1.render(sourced.definition) });
    }
    catch (e) {
        throw new lambda_utils_1.UnderlyingExecutionError(e, 'generate', { sourceName });
    }
}
exports.generate = generate;
exports.default = generate;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2VuZXJhdGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvYWN0aW9ucy9nZW5lcmF0ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQSx5REFBb0Y7QUFDcEYsNkRBQStDO0FBQy9DLCtFQUF5RDtBQUVsRCxLQUFLLFVBQVUsUUFBUSxDQUFDLEdBQVE7SUFDbkMsTUFBTSxPQUFPLEdBQUcsRUFBQyxHQUFHLGdCQUFnQixFQUFFLEdBQUcsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLE9BQU8sSUFBSSxFQUFFLENBQUMsRUFBQyxDQUFDO0lBQ3JFLE1BQU0sVUFBVSxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUMsTUFBTSxJQUFJLFNBQVMsQ0FBQztJQUNqRCxNQUFNLE1BQU0sR0FBRyxPQUFPLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDbkMsSUFBSSxDQUFDLE1BQU07UUFBRSxPQUFPLEdBQUcsQ0FBQyxPQUFPLENBQUMsWUFBWSxFQUFFLENBQUM7SUFDL0MsTUFBTSxPQUFPLEdBQUcsQ0FBQyxNQUFNLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUMxQyxJQUFJLENBQUMsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLFVBQVU7UUFBRSxPQUFPLEdBQUcsQ0FBQyxPQUFPLENBQUMsWUFBWSxFQUFFLENBQUM7SUFDdkUsSUFBSTtRQUNBLE9BQU8sR0FBRyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsRUFBQyxXQUFXLEVBQUUsaUJBQWlCLEVBQUUsR0FBRyxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sZ0NBQU0sQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLEVBQUMsQ0FBQyxDQUFDO0tBQ3JIO0lBQUMsT0FBTyxDQUFDLEVBQUU7UUFDUixNQUFNLElBQUksdUNBQXdCLENBQUMsQ0FBQyxFQUFFLFVBQVUsRUFBRSxFQUFDLFVBQVUsRUFBQyxDQUFDLENBQUM7S0FDbkU7QUFDTCxDQUFDO0FBWkQsNEJBWUM7QUFFRCxrQkFBZSxRQUFRLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge2N0eCwgaHR0cF9yZXNwb25zZSwgVW5kZXJseWluZ0V4ZWN1dGlvbkVycm9yfSBmcm9tIFwiQG9ob2FyZWF1L2xhbWJkYS11dGlsc1wiO1xuaW1wb3J0ICogYXMgYXZhaWxhYmxlU291cmNlcyBmcm9tIFwiLi4vc291cmNlc1wiO1xuaW1wb3J0IHtyZW5kZXJ9IGZyb20gJ0BvaG9hcmVhdS9yZWFjdC1kb2N1bWVudC1yZW5kZXJlcic7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZW5lcmF0ZShjdHg6IGN0eCk6IFByb21pc2U8aHR0cF9yZXNwb25zZT4ge1xuICAgIGNvbnN0IHNvdXJjZXMgPSB7Li4uYXZhaWxhYmxlU291cmNlcywgLi4uKGN0eC5jb25maWcuc291cmNlcyB8fCB7fSl9O1xuICAgIGNvbnN0IHNvdXJjZU5hbWUgPSBjdHgucXVlcnkuc291cmNlIHx8ICdkZWZhdWx0JztcbiAgICBjb25zdCBzb3VyY2UgPSBzb3VyY2VzW3NvdXJjZU5hbWVdO1xuICAgIGlmICghc291cmNlKSByZXR1cm4gY3R4LmhlbHBlcnMuaHR0cE5vdEZvdW5kKCk7XG4gICAgY29uc3Qgc291cmNlZCA9IChhd2FpdCBzb3VyY2UoY3R4KSkgfHwge307XG4gICAgaWYgKCFzb3VyY2VkIHx8ICFzb3VyY2VkLmRlZmluaXRpb24pIHJldHVybiBjdHguaGVscGVycy5odHRwTm90Rm91bmQoKTtcbiAgICB0cnkge1xuICAgICAgICByZXR1cm4gY3R4LmhlbHBlcnMuYnVmZmVyKHtjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL3BkZicsIC4uLnNvdXJjZWQsIGJ1ZmZlcjogYXdhaXQgcmVuZGVyKHNvdXJjZWQuZGVmaW5pdGlvbil9KTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIHRocm93IG5ldyBVbmRlcmx5aW5nRXhlY3V0aW9uRXJyb3IoZSwgJ2dlbmVyYXRlJywge3NvdXJjZU5hbWV9KTtcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IGdlbmVyYXRlIl19